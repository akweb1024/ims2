generator client {
  provider   = "prisma-client-js"
  engineType = "client"
}

datasource db {
  provider = "postgresql"
}

model Company {
  id                  String               @id @default(uuid())
  name                String
  registrationNumber  String?
  domain              String?
  address             String?
  phone               String?
  email               String?
  website             String?
  logoUrl             String?
  fiscalYearStart     Int?
  currency            String               @default("INR")
  timezone            String               @default("Asia/Kolkata")
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  latitude            Float?
  longitude           Float?
  attendance          Attendance[]
  bonusSchemas        BonusSchema[]
  chatRooms           ChatRoom[]
  communications      CommunicationLog[]
  potential           CompanyPotential?
  conferences         Conference[]
  courses             Course[]
  customers           CustomerProfile[]
  departments         Department[]
  departmentBudgets   DepartmentBudget[]
  dispatchOrders      DispatchOrder[]
  documentTemplates   DocumentTemplate[]
  employeeGoals       EmployeeGoal[]
  employeeKpis        EmployeeKPI[]
  financialRecords    FinancialRecord[]
  holidays            Holiday[]
  itAssets            ITAsset[]
  itTickets           ITSupportTicket[]
  incentiveSchemas    IncentiveSchema[]
  institutions        Institution[]
  invoices            Invoice[]
  jobPostings         JobPosting[]
  leaveLedgers        LeaveLedger[]
  leaveRequests       LeaveRequest[]
  onboardingModules   OnboardingModule[]
  payments            Payment[]
  performanceInsights PerformanceInsight[]
  performanceReviews  PerformanceReview[]
  salaryAdvances      SalaryAdvance[]
  salarySlips         SalarySlip[]
  shifts              Shift[]
  shiftRosters        ShiftRoster[]
  statutoryConfig     StatutoryConfig?
  subscriptions       Subscription[]
  supportTickets      SupportTicket[]
  tasks               Task[]
  primaryUsers        User[]               @relation("PrimaryCompany")
  workPlans           WorkPlan[]
  workReports         WorkReport[]
  designations        Designation[]        @relation("CompanyToDesignation")
  users               User[]               @relation("UserCompanies")
}

model Department {
  id                 String             @id @default(uuid())
  companyId          String
  name               String
  code               String?
  description        String?
  parentDepartmentId String?
  headUserId         String?
  isActive           Boolean            @default(true)
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt
  company            Company            @relation(fields: [companyId], references: [id], onDelete: Cascade)
  headUser           User?              @relation("DepartmentHead", fields: [headUserId], references: [id])
  parentDepartment   Department?        @relation("DepartmentHierarchy", fields: [parentDepartmentId], references: [id])
  subDepartments     Department[]       @relation("DepartmentHierarchy")
  budgets            DepartmentBudget[]
  jobApplications    JobApplication[]
  jobPostings        JobPosting[]
  onboardingModules  OnboardingModule[]
  users              User[]             @relation("DepartmentMembers")
  designations       Designation[]      @relation("DepartmentToDesignation")

  @@unique([companyId, code])
  @@index([companyId])
}

model User {
  id                    String                 @id @default(uuid())
  email                 String                 @unique
  password              String
  role                  UserRole
  isActive              Boolean                @default(true)
  emailVerified         Boolean                @default(false)
  lastLogin             DateTime?
  theme                 String                 @default("light")
  notificationsEnabled  Boolean                @default(true)
  companyId             String?
  departmentId          String?
  managerId             String?
  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @updatedAt
  name                  String?
  announcements         Announcement[]
  auditLogs             AuditLog[]
  sentMessages          ChatMessage[]
  chatParticipants      ChatParticipant[]
  communications        CommunicationLog[]     @relation("UserCommunications")
  courseEnrollments     CourseEnrollment[]
  customerAssignments   CustomerAssignment[]   @relation("EmployeeAssignments")
  assignedCustomers     CustomerProfile[]      @relation("AssignedCustomers")
  customerProfile       CustomerProfile?
  headOfDepartments     Department[]           @relation("DepartmentHead")
  authoredComments      EmployeeComment[]
  employeeProfile       EmployeeProfile?
  createdFinanceRecords FinancialRecord[]      @relation("FinanceCreator")
  assignedAssets        ITAsset[]
  itResolutions         ITSupportTicket[]      @relation("ITResolver")
  itRequests            ITSupportTicket[]      @relation("ITRequestor")
  assignedInstitutions  Institution[]          @relation("InstitutionOwner")
  managedJournals       Journal[]              @relation("JournalEditor")
  knowledgeArticles     KnowledgeArticle[]
  approvedLeaves        LeaveRequest[]         @relation("LeaveApprover")
  notifications         Notification[]
  performanceReviews    PerformanceReview[]    @relation("Reviewer")
  pushSubscriptions     PushSubscription[]
  interviewsConducted   RecruitmentInterview[] @relation("RecruitmentInterviewer")
  reviews               Review[]
  assignedSubscriptions Subscription[]         @relation("AssignedSalesExecutive")
  assignedTickets       SupportTicket[]        @relation("AssignedTickets")
  tasks                 Task[]
  company               Company?               @relation("PrimaryCompany", fields: [companyId], references: [id])
  department            Department?            @relation("DepartmentMembers", fields: [departmentId], references: [id])
  manager               User?                  @relation("ManagementChain", fields: [managerId], references: [id])
  subordinates          User[]                 @relation("ManagementChain")
  lessonProgress        UserLessonProgress[]
  workPlanComments      WorkPlanComment[]
  workReportComments    WorkReportComment[]    @relation("WorkReportCommentAuthor")
  assignedToCustomers   CustomerProfile[]      @relation("CustomerToExecutives")
  companies             Company[]              @relation("UserCompanies")
  
  // LMS Relations
  quizAttempts          QuizAttempt[]
  courseNotes           CourseNote[]
  courseDiscussions     CourseDiscussion[]
  discussionReplies     DiscussionReply[]
  certificates          Certificate[]

  @@index([email])
  @@index([role])
  @@index([companyId])
  @@index([departmentId])
}

model Announcement {
  id         String    @id @default(uuid())
  title      String
  content    String
  authorId   String
  targetRole String    @default("ALL")
  priority   String    @default("NORMAL")
  isActive   Boolean   @default(true)
  expiresAt  DateTime?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  author     User      @relation(fields: [authorId], references: [id])
}

model KnowledgeArticle {
  id         String   @id @default(uuid())
  title      String
  content    String
  category   String
  targetRole String   @default("ALL")
  authorId   String
  views      Int      @default(0)
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  author     User     @relation(fields: [authorId], references: [id])
}

model CustomerProfile {
  id                 String               @id @default(uuid())
  userId             String               @unique
  customerType       CustomerType
  assignedToUserId   String?
  name               String
  organizationName   String?
  primaryEmail       String
  secondaryEmail     String?
  primaryPhone       String
  secondaryPhone     String?
  gstVatTaxId        String?
  billingAddress     String?
  shippingAddress    String?
  country            String?
  state              String?
  city               String?
  pincode            String?
  preferredChannel   String?
  notes              String?
  tags               String?
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @updatedAt
  companyId          String?
  designation        CustomerDesignation?
  institutionId      String?
  agencyDetails      AgencyDetails?
  communications     CommunicationLog[]
  assignments        CustomerAssignment[]
  assignedTo         User?                @relation("AssignedCustomers", fields: [assignedToUserId], references: [id])
  company            Company?             @relation(fields: [companyId], references: [id])
  institution        Institution?         @relation(fields: [institutionId], references: [id])
  user               User                 @relation(fields: [userId], references: [id], onDelete: Cascade)
  institutionDetails InstitutionDetails?
  invoices           Invoice[]
  subscriptions      Subscription[]
  supportTickets     SupportTicket[]
  assignedExecutives User[]               @relation("CustomerToExecutives")

  @@index([customerType])
  @@index([primaryEmail])
  @@index([companyId])
  @@index([institutionId])
  @@index([designation])
}

model InstitutionDetails {
  id                String          @id @default(uuid())
  customerProfileId String          @unique
  category          String
  department        String?
  libraryContact    String?
  ipRange           String?
  numberOfUsers     Int?
  numberOfSeats     Int?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  customerProfile   CustomerProfile @relation(fields: [customerProfileId], references: [id], onDelete: Cascade)
}

model AgencyDetails {
  id                String          @id @default(uuid())
  customerProfileId String          @unique
  companyInfo       String?
  territory         String?
  region            String?
  primaryContact    String?
  commissionTerms   String?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  customerProfile   CustomerProfile @relation(fields: [customerProfileId], references: [id], onDelete: Cascade)
  subscriptions     Subscription[]
}

model Institution {
  id               String             @id @default(uuid())
  name             String
  code             String             @unique
  type             InstitutionType
  category         String?
  establishedYear  Int?
  accreditation    String?
  primaryEmail     String?
  secondaryEmail   String?
  primaryPhone     String?
  secondaryPhone   String?
  website          String?
  address          String?
  city             String?
  state            String?
  country          String             @default("India")
  pincode          String?
  totalStudents    Int?
  totalFaculty     Int?
  totalStaff       Int?
  libraryBudget    Float?
  ipRange          String?
  notes            String?
  logo             String?
  isActive         Boolean            @default(true)
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  companyId        String?
  assignedToUserId String?
  domain           String?
  communications   CommunicationLog[]
  customers        CustomerProfile[]
  assignedTo       User?              @relation("InstitutionOwner", fields: [assignedToUserId], references: [id])
  company          Company?           @relation(fields: [companyId], references: [id])
  subscriptions    Subscription[]

  @@index([code])
  @@index([type])
  @@index([companyId])
}

model CustomerAssignment {
  id         String          @id @default(uuid())
  customerId String
  employeeId String
  assignedAt DateTime        @default(now())
  assignedBy String?
  role       String?
  isActive   Boolean         @default(true)
  notes      String?
  customer   CustomerProfile @relation(fields: [customerId], references: [id], onDelete: Cascade)
  employee   User            @relation("EmployeeAssignments", fields: [employeeId], references: [id], onDelete: Cascade)

  @@unique([customerId, employeeId])
  @@index([customerId])
  @@index([employeeId])
  @@index([isActive])
}

model Journal {
  id                String             @id @default(uuid())
  name              String
  issnPrint         String?
  issnOnline        String?
  frequency         String
  formatAvailable   String?
  subjectCategory   String?
  isActive          Boolean            @default(true)
  priceINR          Float              @default(0)
  priceUSD          Float              @default(0)
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  apcOpenAccessINR  Float              @default(0)
  apcOpenAccessUSD  Float              @default(0)
  apcOtherINR       Float              @default(0)
  apcOtherUSD       Float              @default(0)
  apcRapidINR       Float              @default(0)
  apcRapidUSD       Float              @default(0)
  apcWoSINR         Float              @default(0)
  apcWoSUSD         Float              @default(0)
  editorId          String?
  articles          Article[]
  editor            User?              @relation("JournalEditor", fields: [editorId], references: [id])
  volumes           JournalVolume[]
  plans             Plan[]
  subscriptionItems SubscriptionItem[]

  @@index([isActive])
  @@index([name])
}

model Plan {
  id                String             @id @default(uuid())
  journalId         String
  planType          String
  format            String
  institutionTier   String?
  duration          Int
  priceINR          Float              @default(0)
  priceUSD          Float              @default(0)
  startDateRule     String?
  gracePeriod       Int                @default(30)
  isActive          Boolean            @default(true)
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  journal           Journal            @relation(fields: [journalId], references: [id], onDelete: Cascade)
  subscriptionItems SubscriptionItem[]

  @@index([journalId])
  @@index([isActive])
}

model Subscription {
  id                   String             @id @default(uuid())
  customerProfileId    String
  salesChannel         SalesChannel
  agencyId             String?
  salesExecutiveId     String?
  startDate            DateTime
  endDate              DateTime
  autoRenew            Boolean            @default(false)
  status               SubscriptionStatus @default(PENDING_PAYMENT)
  currency             String             @default("INR")
  subtotal             Float
  discount             Float              @default(0)
  tax                  Float              @default(0)
  total                Float
  invoiceReference     String?
  parentSubscriptionId String?
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @updatedAt
  companyId            String?
  institutionId        String?
  subtotalInINR        Float              @default(0)
  subtotalInUSD        Float              @default(0)
  totalInINR           Float              @default(0)
  totalInUSD           Float              @default(0)
  invoices             Invoice[]
  agency               AgencyDetails?     @relation(fields: [agencyId], references: [id])
  company              Company?           @relation(fields: [companyId], references: [id])
  customerProfile      CustomerProfile    @relation(fields: [customerProfileId], references: [id])
  institution          Institution?       @relation(fields: [institutionId], references: [id])
  parentSubscription   Subscription?      @relation("SubscriptionRenewal", fields: [parentSubscriptionId], references: [id])
  renewals             Subscription[]     @relation("SubscriptionRenewal")
  salesExecutive       User?              @relation("AssignedSalesExecutive", fields: [salesExecutiveId], references: [id])
  items                SubscriptionItem[]

  @@index([customerProfileId])
  @@index([status])
  @@index([salesChannel])
  @@index([startDate, endDate])
  @@index([companyId])
  @@index([institutionId])
}

model SubscriptionItem {
  id             String       @id @default(uuid())
  subscriptionId String
  journalId      String
  planId         String
  quantity       Int          @default(1)
  seats          Int?
  price          Float
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  journal        Journal      @relation(fields: [journalId], references: [id])
  plan           Plan         @relation(fields: [planId], references: [id])
  subscription   Subscription @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)

  @@index([subscriptionId])
}

model Invoice {
  id                String           @id @default(uuid())
  subscriptionId    String?
  invoiceNumber     String           @unique
  currency          String           @default("INR")
  amount            Float
  tax               Float
  total             Float
  status            InvoiceStatus    @default(UNPAID)
  dueDate           DateTime
  paidDate          DateTime?
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  companyId         String?
  customerProfileId String?
  description       String?
  lineItems         Json?
  company           Company?         @relation(fields: [companyId], references: [id])
  customerProfile   CustomerProfile? @relation(fields: [customerProfileId], references: [id])
  subscription      Subscription?    @relation(fields: [subscriptionId], references: [id])
  payments          Payment[]

  @@index([subscriptionId])
  @@index([customerProfileId])
  @@index([status])
  @@index([invoiceNumber])
  @@index([companyId])
}

model Payment {
  id                String   @id @default(uuid())
  invoiceId         String?
  amount            Float
  paymentMethod     String?
  paymentDate       DateTime
  transactionId     String?
  notes             String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  companyId         String?
  razorpayOrderId   String?
  razorpayPaymentId String?  @unique
  razorpaySignature String?
  status            String?
  conversionRate    Float?   @default(1.0)
  currency          String   @default("INR")
  metadata          String?
  company           Company? @relation(fields: [companyId], references: [id])
  invoice           Invoice? @relation(fields: [invoiceId], references: [id])

  @@index([invoiceId])
  @@index([companyId])
}

model RazorpaySync {
  id          String   @id @default(uuid())
  lastSyncAt  DateTime
  status      String
  error       String?
  syncedCount Int      @default(0)
  createdAt   DateTime @default(now())
}

model CommunicationLog {
  id                  String            @id @default(uuid())
  customerProfileId   String
  userId              String?
  type                CommunicationType @default(COMMENT)
  date                DateTime          @default(now())
  channel             String
  subject             String
  notes               String
  outcome             String?
  duration            Int?
  recordingUrl        String?
  referenceId         String?
  nextFollowUpDate    DateTime?
  isFollowUpCompleted Boolean           @default(false)
  attachments         String?
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  companyId           String?
  institutionId       String?
  company             Company?          @relation(fields: [companyId], references: [id])
  customerProfile     CustomerProfile   @relation(fields: [customerProfileId], references: [id])
  institution         Institution?      @relation(fields: [institutionId], references: [id])
  user                User?             @relation("UserCommunications", fields: [userId], references: [id])

  @@index([customerProfileId])
  @@index([type])
  @@index([date])
  @@index([nextFollowUpDate])
  @@index([companyId])
  @@index([institutionId])
}

model Task {
  id                    String     @id @default(uuid())
  userId                String
  title                 String
  description           String?
  dueDate               DateTime
  priority              Priority   @default(MEDIUM)
  status                TaskStatus @default(PENDING)
  relatedCustomerId     String?
  relatedSubscriptionId String?
  createdAt             DateTime   @default(now())
  updatedAt             DateTime   @updatedAt
  companyId             String?
  company               Company?   @relation(fields: [companyId], references: [id])
  user                  User       @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([status])
  @@index([dueDate])
  @@index([companyId])
}

model AuditLog {
  id        String   @id @default(uuid())
  userId    String?
  action    String
  entity    String
  entityId  String
  changes   Json?
  ipAddress String?
  createdAt DateTime @default(now())
  user      User?    @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([entity, entityId])
  @@index([createdAt])
}

model ChatRoom {
  id            String            @id @default(uuid())
  name          String?
  isGroup       Boolean           @default(false)
  companyId     String?
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  messages      ChatMessage[]
  participants  ChatParticipant[]
  company       Company?          @relation(fields: [companyId], references: [id])
  supportTicket SupportTicket?

  @@index([companyId])
}

model ChatParticipant {
  id       String   @id @default(uuid())
  roomId   String
  userId   String
  joinedAt DateTime @default(now())
  room     ChatRoom @relation(fields: [roomId], references: [id], onDelete: Cascade)
  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([roomId, userId])
  @@index([roomId])
  @@index([userId])
}

model ChatMessage {
  id        String   @id @default(uuid())
  roomId    String
  senderId  String
  content   String
  createdAt DateTime @default(now())
  room      ChatRoom @relation(fields: [roomId], references: [id], onDelete: Cascade)
  sender    User     @relation(fields: [senderId], references: [id], onDelete: Cascade)

  @@index([roomId])
  @@index([senderId])
}

model SupportTicket {
  id                String          @id @default(uuid())
  companyId         String?
  customerProfileId String
  subject           String
  description       String
  status            TicketStatus    @default(OPEN)
  priority          Priority        @default(MEDIUM)
  assignedToId      String?
  chatRoomId        String?         @unique
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  assignedTo        User?           @relation("AssignedTickets", fields: [assignedToId], references: [id])
  chatRoom          ChatRoom?       @relation(fields: [chatRoomId], references: [id])
  company           Company?        @relation(fields: [companyId], references: [id])
  customerProfile   CustomerProfile @relation(fields: [customerProfileId], references: [id])

  @@index([companyId])
  @@index([customerProfileId])
  @@index([status])
}

model Notification {
  id        String   @id @default(uuid())
  userId    String
  title     String
  message   String
  type      String   @default("INFO")
  link      String?
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isRead])
}

model PushSubscription {
  id        String   @id @default(uuid())
  userId    String
  endpoint  String   @unique
  p256dh    String
  auth      String
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model SystemSettings {
  id              String   @id @default("singleton")
  maintenanceMode Boolean  @default(false)
  supportEmail    String   @default("support@stm.com")
  defaultCurrency String   @default("INR")
  companyName     String   @default("STM Journal Solutions")
  updatedAt       DateTime @updatedAt
}

model Designation {
  id                  String            @id @default(uuid())
  name                String
  code                String?
  jobDescription      String?
  kra                 String?
  expectedExperience  Float             @default(0)
  promotionWaitPeriod Int               @default(12)
  incrementGuidelines String?
  level               Int               @default(1)
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  employees           EmployeeProfile[]
  companies           Company[]         @relation("CompanyToDesignation")
  departments         Department[]      @relation("DepartmentToDesignation")
}

model EmployeeProfile {
  id                       String                  @id @default(uuid())
  userId                   String                  @unique
  employeeId               String?                 @unique
  designation              String?
  dateOfJoining            DateTime?
  dateOfBirth              DateTime?
  baseSalary               Float?
  bankName                 String?
  accountNumber            String?
  ifscCode                 String?
  panNumber                String?
  personalEmail            String?
  phoneNumber              String?
  emergencyContact         String?
  address                  String?
  createdAt                DateTime                @default(now())
  updatedAt                DateTime                @updatedAt
  contractUrl              String?
  offerLetterUrl           String?
  jobDescription           String?
  kra                      String?
  bloodGroup               String?
  profilePicture           String?
  designationId            String?
  grade                    String?
  lastIncrementDate        DateTime?
  lastIncrementPercentage  Float?
  lastPromotionDate        DateTime?
  nextReviewDate           DateTime?
  qualification            String?
  relevantExperienceMonths Int                     @default(0)
  relevantExperienceYears  Int                     @default(0)
  totalExperienceMonths    Int                     @default(0)
  totalExperienceYears     Int                     @default(0)
  aadharNumber             String?
  educationDetails         Json?
  esicNumber               String?
  experienceDetails        Json?
  officePhone              String?
  officialEmail            String?
  permanentAddress         String?
  pfNumber                 String?
  uanNumber                String?
  manualLeaveAdjustment    Float                   @default(0)
  leaveBalance             Float                   @default(0)
  metrics                  Json?
  employeeType             EmployeeType            @default(FULL_TIME)
  attendance               Attendance[]
  digitalDocuments         DigitalDocument[]
  hrComments               EmployeeComment[]
  documents                EmployeeDocument[]
  goals                    EmployeeGoal[]
  incentives               EmployeeIncentive[]
  kpis                     EmployeeKPI[]
  designatRef              Designation?            @relation(fields: [designationId], references: [id])
  user                     User                    @relation(fields: [userId], references: [id], onDelete: Cascade)
  leaveLedgers             LeaveLedger[]
  leaveRequests            LeaveRequest[]
  onboardingProgress       OnboardingProgress[]
  performanceInsights      PerformanceInsight[]
  performance              PerformanceReview[]
  salaryAdvances           SalaryAdvance[]
  incrementHistory         SalaryIncrementRecord[]
  salarySlips              SalarySlip[]
  salaryStructure          SalaryStructure?
  shiftRosters             ShiftRoster[]
  taxDeclarations          TaxDeclaration[]
  workPlans                WorkPlan[]
  workReports              WorkReport[]
}

model SalaryAdvance {
  id         String          @id @default(uuid())
  employeeId String
  amount     Float
  reason     String?
  status     String          @default("PENDING")
  totalEmis  Int             @default(1)
  paidEmis   Int             @default(0)
  emiAmount  Float
  startDate  DateTime        @default(now())
  companyId  String?
  createdAt  DateTime        @default(now())
  updatedAt  DateTime        @default(now())
  emis       AdvanceEMI[]
  company    Company?        @relation(fields: [companyId], references: [id])
  employee   EmployeeProfile @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@index([employeeId])
  @@index([companyId])
}

model AdvanceEMI {
  id           String        @id @default(uuid())
  advanceId    String
  salarySlipId String?       @unique
  amount       Float
  month        Int
  year         Int
  status       String        @default("PENDING")
  paidAt       DateTime?
  createdAt    DateTime      @default(now())
  advance      SalaryAdvance @relation(fields: [advanceId], references: [id], onDelete: Cascade)
  salarySlip   SalarySlip?   @relation(fields: [salarySlipId], references: [id])
}

model SalaryIncrementRecord {
  id                  String          @id @default(uuid())
  employeeProfileId   String
  date                DateTime        @default(now())
  effectiveDate       DateTime        @default(now())
  oldSalary           Float
  newSalary           Float
  incrementAmount     Float
  percentage          Float
  type                String          @default("INCREMENT")
  previousDesignation String?
  newDesignation      String?
  reason              String?
  approvedByUserId    String?
  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @updatedAt
  employeeProfile     EmployeeProfile @relation(fields: [employeeProfileId], references: [id], onDelete: Cascade)
}

model EmployeeComment {
  id                  String          @id @default(uuid())
  employeeProfileId   String
  authorId            String
  content             String
  type                String          @default("GENERAL")
  isVisibleToEmployee Boolean         @default(false)
  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @updatedAt
  author              User            @relation(fields: [authorId], references: [id])
  employeeProfile     EmployeeProfile @relation(fields: [employeeProfileId], references: [id], onDelete: Cascade)
}

model EmployeeDocument {
  id         String          @id @default(uuid())
  employeeId String
  name       String
  fileUrl    String
  fileType   String?
  uploadedAt DateTime        @default(now())
  employee   EmployeeProfile @relation(fields: [employeeId], references: [id], onDelete: Cascade)
}

model Attendance {
  id           String          @id @default(uuid())
  employeeId   String
  date         DateTime        @default(now())
  checkIn      DateTime?
  checkOut     DateTime?
  status       String          @default("PRESENT")
  workFrom     String          @default("OFFICE")
  deviceInfo   String?
  isGeofenced  Boolean         @default(false)
  latitude     Float?
  locationName String?
  longitude    Float?
  companyId    String?
  lateMinutes  Int             @default(0)
  otMinutes    Int             @default(0)
  shiftId      String?
  company      Company?        @relation(fields: [companyId], references: [id])
  employee     EmployeeProfile @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  shift        Shift?          @relation(fields: [shiftId], references: [id])

  @@unique([employeeId, date])
  @@index([companyId])
}

model WorkReport {
  id                 String              @id @default(uuid())
  employeeId         String
  date               DateTime            @default(now())
  title              String
  content            String?
  hoursSpent         Float?
  status             String              @default("SUBMITTED")
  managerComment     String?
  createdAt          DateTime            @default(now())
  category           String              @default("GENERAL")
  keyOutcome         String?
  managerRating      Int?
  selfRating         Int?                @default(5)
  revenueGenerated   Float               @default(0)
  tasksCompleted     Int                 @default(0)
  chatsHandled       Int                 @default(0)
  followUpsCompleted Int                 @default(0)
  ticketsResolved    Int                 @default(0)
  companyId          String?
  kraMatchRatio      Float?
  metrics            Json?
  company            Company?            @relation(fields: [companyId], references: [id])
  employee           EmployeeProfile     @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  comments           WorkReportComment[]

  @@index([companyId])
  @@index([employeeId])
}

model WorkReportComment {
  id           String     @id @default(uuid())
  workReportId String
  authorId     String
  content      String
  createdAt    DateTime   @default(now())
  author       User       @relation("WorkReportCommentAuthor", fields: [authorId], references: [id])
  workReport   WorkReport @relation(fields: [workReportId], references: [id], onDelete: Cascade)

  @@index([workReportId])
}

model Holiday {
  id          String   @id @default(uuid())
  name        String
  date        DateTime
  type        String   @default("PUBLIC")
  description String?
  companyId   String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  company     Company? @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([date])
}

model InventoryItem {
  id           String   @id @default(uuid())
  name         String
  sku          String   @unique
  currentStock Int
  minThreshold Int      @default(10)
  category     String
  price        Float    @default(0)
  updatedAt    DateTime @updatedAt
}

model ProductionOrder {
  id         String   @id @default(uuid())
  itemSku    String
  quantity   Int
  status     String   @default("PLANNED")
  priority   String   @default("MEDIUM")
  reason     String?
  targetDate DateTime
  createdAt  DateTime @default(now())
}

model SalarySlip {
  id                String          @id @default(uuid())
  employeeId        String
  month             Int
  year              Int
  amountPaid        Float
  status            String          @default("GENERATED")
  fileUrl           String?
  generatedAt       DateTime        @default(now())
  companyId         String?
  advanceDeduction  Float           @default(0)
  lwpDeduction      Float           @default(0)
  basicSalary       Float           @default(0)
  conveyance        Float           @default(0)
  ctc               Float           @default(0)
  esicEmployee      Float           @default(0)
  esicEmployer      Float           @default(0)
  grossSalary       Float           @default(0)
  hra               Float           @default(0)
  medical           Float           @default(0)
  otherAllowances   Float           @default(0)
  pfEmployee        Float           @default(0)
  pfEmployer        Float           @default(0)
  professionalTax   Float           @default(0)
  specialAllowance  Float           @default(0)
  tds               Float           @default(0)
  totalDeductions   Float           @default(0)
  arrears           Float           @default(0)
  isFinalSettlement Boolean         @default(false)
  notes             String?
  advanceEmi        AdvanceEMI?
  arrearRecords     ArrearRecord[]
  company           Company?        @relation(fields: [companyId], references: [id])
  employee          EmployeeProfile @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@index([companyId])
}

model ArrearRecord {
  id           String     @id @default(uuid())
  salarySlipId String
  type         String
  amount       Float
  description  String?
  createdAt    DateTime   @default(now())
  salarySlip   SalarySlip @relation(fields: [salarySlipId], references: [id], onDelete: Cascade)

  @@index([salarySlipId])
}

model DepartmentBudget {
  id           String     @id @default(uuid())
  departmentId String
  companyId    String
  fiscalYear   Int
  month        Int?
  allocated    Float
  spent        Float      @default(0)
  category     String     @default("SALARY")
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  company      Company    @relation(fields: [companyId], references: [id])
  department   Department @relation(fields: [departmentId], references: [id], onDelete: Cascade)

  @@index([departmentId])
  @@index([companyId])
}

model StatutoryConfig {
  id               String   @id @default(uuid())
  companyId        String   @unique
  pfEmployeeRate   Float    @default(12.0)
  pfEmployerRate   Float    @default(12.0)
  pfCeilingAmount  Float    @default(15000.0)
  pfAdminCharges   Float    @default(0.5)
  esicEmployeeRate Float    @default(0.75)
  esicEmployerRate Float    @default(3.25)
  esicLimitAmount  Float    @default(21000.0)
  ptEnabled        Boolean  @default(true)
  state            String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  company          Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
}

model TaxDeclaration {
  id               String             @id @default(uuid())
  employeeId       String
  fiscalYear       String
  regime           String             @default("NEW")
  section80C       Float              @default(0)
  section80D       Float              @default(0)
  nps              Float              @default(0)
  hraRentPaid      Float              @default(0)
  homeLoanInterest Float              @default(0)
  otherIncome      Float              @default(0)
  status           String             @default("DRAFT")
  adminComment     String?
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  proofs           DeclarationProof[]
  employee         EmployeeProfile    @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@index([employeeId])
}

model DeclarationProof {
  id               String         @id @default(uuid())
  taxDeclarationId String
  category         String
  fileUrl          String
  fileName         String
  amount           Float
  status           String         @default("PENDING")
  createdAt        DateTime       @default(now())
  taxDeclaration   TaxDeclaration @relation(fields: [taxDeclarationId], references: [id], onDelete: Cascade)
}

model Shift {
  id           String        @id @default(uuid())
  name         String
  startTime    String
  endTime      String
  gracePeriod  Int           @default(15)
  isNightShift Boolean       @default(false)
  companyId    String
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  attendances  Attendance[]
  company      Company       @relation(fields: [companyId], references: [id], onDelete: Cascade)
  rosters      ShiftRoster[]

  @@index([companyId])
}

model ShiftRoster {
  id         String          @id @default(uuid())
  employeeId String
  shiftId    String
  date       DateTime
  companyId  String
  createdAt  DateTime        @default(now())
  company    Company         @relation(fields: [companyId], references: [id], onDelete: Cascade)
  employee   EmployeeProfile @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  shift      Shift           @relation(fields: [shiftId], references: [id], onDelete: Cascade)

  @@unique([employeeId, date])
  @@index([companyId])
}

model SalaryStructure {
  id               String          @id @default(uuid())
  employeeId       String          @unique
  basicSalary      Float           @default(0)
  hra              Float           @default(0)
  conveyance       Float           @default(0)
  medical          Float           @default(0)
  specialAllowance Float           @default(0)
  otherAllowances  Float           @default(0)
  grossSalary      Float           @default(0)
  pfEmployee       Float           @default(0)
  esicEmployee     Float           @default(0)
  professionalTax  Float           @default(0)
  tds              Float           @default(0)
  totalDeductions  Float           @default(0)
  pfEmployer       Float           @default(0)
  esicEmployer     Float           @default(0)
  gratuity         Float           @default(0)
  insurance        Float           @default(0)
  netSalary        Float           @default(0)
  ctc              Float           @default(0)
  effectiveFrom    DateTime        @default(now())
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt
  employee         EmployeeProfile @relation(fields: [employeeId], references: [id], onDelete: Cascade)
}

model PerformanceReview {
  id         String          @id @default(uuid())
  employeeId String
  reviewerId String
  date       DateTime        @default(now())
  rating     Int
  feedback   String?
  period     String?
  companyId  String?
  createdAt  DateTime        @default(now())
  company    Company?        @relation(fields: [companyId], references: [id])
  employee   EmployeeProfile @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  reviewer   User            @relation("Reviewer", fields: [reviewerId], references: [id])

  @@index([companyId])
}

model EmployeeKPI {
  id         String          @id @default(uuid())
  employeeId String
  title      String
  target     Float
  current    Float           @default(0)
  unit       String
  period     String
  category   String          @default("GENERAL")
  companyId  String
  createdAt  DateTime        @default(now())
  updatedAt  DateTime        @default(now())
  goals      EmployeeGoal[]
  company    Company         @relation(fields: [companyId], references: [id])
  employee   EmployeeProfile @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@index([employeeId])
  @@index([companyId])
}

model PerformanceInsight {
  id         String          @id @default(uuid())
  employeeId String
  content    String
  type       String
  date       DateTime        @default(now())
  companyId  String
  company    Company         @relation(fields: [companyId], references: [id])
  employee   EmployeeProfile @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@index([employeeId])
  @@index([companyId])
}

model LeaveRequest {
  id           String          @id @default(uuid())
  employeeId   String
  startDate    DateTime
  endDate      DateTime
  reason       String
  type         String
  status       String          @default("PENDING")
  approvedById String?
  createdAt    DateTime        @default(now())
  companyId    String?
  approvedBy   User?           @relation("LeaveApprover", fields: [approvedById], references: [id])
  company      Company?        @relation(fields: [companyId], references: [id])
  employee     EmployeeProfile @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@index([companyId])
}

model WorkPlan {
  id         String            @id @default(uuid())
  employeeId String
  date       DateTime
  agenda     String
  strategy   String?
  status     String            @default("SHARED")
  createdAt  DateTime          @default(now())
  updatedAt  DateTime          @updatedAt
  companyId  String?
  company    Company?          @relation(fields: [companyId], references: [id])
  employee   EmployeeProfile   @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  comments   WorkPlanComment[]

  @@unique([employeeId, date])
  @@index([companyId])
}

model OnboardingModule {
  id                     String               @id @default(uuid())
  title                  String
  type                   String
  description            String?
  content                String
  departmentId           String?
  companyId              String
  requiredForDesignation String?
  order                  Int                  @default(0)
  isActive               Boolean              @default(true)
  createdAt              DateTime             @default(now())
  updatedAt              DateTime             @updatedAt
  company                Company              @relation(fields: [companyId], references: [id])
  department             Department?          @relation(fields: [departmentId], references: [id])
  progress               OnboardingProgress[]
  questions              QuizQuestion[]

  @@index([companyId])
}

model QuizQuestion {
  id            String           @id @default(uuid())
  moduleId      String
  question      String
  options       String[]
  correctAnswer Int
  createdAt     DateTime         @default(now())
  module        OnboardingModule @relation(fields: [moduleId], references: [id], onDelete: Cascade)
}

model OnboardingProgress {
  id          String           @id @default(uuid())
  employeeId  String
  moduleId    String
  status      String           @default("LOCKED")
  score       Float?
  completedAt DateTime?
  updatedAt   DateTime         @updatedAt
  employee    EmployeeProfile  @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  module      OnboardingModule @relation(fields: [moduleId], references: [id])

  @@unique([employeeId, moduleId])
}

model WorkPlanComment {
  id         String   @id @default(uuid())
  workPlanId String
  userId     String
  content    String
  createdAt  DateTime @default(now())
  user       User     @relation(fields: [userId], references: [id])
  workPlan   WorkPlan @relation(fields: [workPlanId], references: [id], onDelete: Cascade)
}

model DocumentTemplate {
  id               String            @id @default(uuid())
  title            String
  type             String
  content          String
  companyId        String
  isActive         Boolean           @default(true)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  digitalDocuments DigitalDocument[]
  company          Company           @relation(fields: [companyId], references: [id])

  @@index([companyId])
}

model DigitalDocument {
  id          String           @id @default(uuid())
  templateId  String
  employeeId  String
  title       String
  content     String
  status      String           @default("PENDING")
  signedAt    DateTime?
  signatureIp String?
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  employee    EmployeeProfile  @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  template    DocumentTemplate @relation(fields: [templateId], references: [id])

  @@index([employeeId])
}

model JobPosting {
  id           String           @id @default(uuid())
  companyId    String
  title        String
  description  String
  requirements String?
  location     String?
  salaryRange  String?
  type         String           @default("FULL_TIME")
  status       String           @default("OPEN")
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt
  departmentId String?
  applications JobApplication[]
  company      Company          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  department   Department?      @relation(fields: [departmentId], references: [id])
  exam         RecruitmentExam?
}

model JobApplication {
  id             String                 @id @default(uuid())
  jobPostingId   String
  applicantName  String
  applicantEmail String
  applicantPhone String?
  resumeUrl      String?
  status         String                 @default("APPLIED")
  offerLetterUrl String?
  contractUrl    String?
  createdAt      DateTime               @default(now())
  updatedAt      DateTime               @updatedAt
  departmentId   String?
  examAttempt    ExamAttempt?
  department     Department?            @relation(fields: [departmentId], references: [id])
  jobPosting     JobPosting             @relation(fields: [jobPostingId], references: [id], onDelete: Cascade)
  interviews     RecruitmentInterview[]
}

model RecruitmentExam {
  id             String        @id @default(uuid())
  jobPostingId   String        @unique
  questions      Json
  timeLimit      Int           @default(30)
  passPercentage Float         @default(75.0)
  attempts       ExamAttempt[]
  jobPosting     JobPosting    @relation(fields: [jobPostingId], references: [id], onDelete: Cascade)
}

model ExamAttempt {
  id            String          @id @default(uuid())
  applicationId String          @unique
  examId        String
  score         Float
  isPassed      Boolean
  answers       Json
  startedAt     DateTime        @default(now())
  completedAt   DateTime?
  application   JobApplication  @relation(fields: [applicationId], references: [id], onDelete: Cascade)
  exam          RecruitmentExam @relation(fields: [examId], references: [id])
}

model RecruitmentInterview {
  id            String         @id @default(uuid())
  applicationId String
  level         Int
  interviewerId String
  scheduledAt   DateTime
  status        String         @default("SCHEDULED")
  result        String         @default("PENDING")
  feedback      String?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  duration      Int            @default(30)
  location      String?
  meetingLink   String?
  rating        Int?
  type          String         @default("VIRTUAL")
  application   JobApplication @relation(fields: [applicationId], references: [id], onDelete: Cascade)
  interviewer   User           @relation("RecruitmentInterviewer", fields: [interviewerId], references: [id])

  @@unique([applicationId, level])
}

model Courier {
  id          String          @id @default(uuid())
  name        String
  website     String?
  apiEndpoint String?
  apiKey      String?
  isActive    Boolean         @default(true)
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  dispatches  DispatchOrder[]
}

model DispatchOrder {
  id                String         @id @default(uuid())
  subscriptionId    String?
  invoiceId         String?
  recipientName     String
  address           String
  city              String
  state             String
  pincode           String
  country           String
  phone             String
  items             Json
  weight            Float?
  courierId         String?
  trackingNumber    String?
  status            DispatchStatus @default(PENDING)
  shippedDate       DateTime?
  deliveredDate     DateTime?
  generatedLabelUrl String?
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  companyId         String?
  company           Company?       @relation(fields: [companyId], references: [id])
  courier           Courier?       @relation(fields: [courierId], references: [id])

  @@index([companyId])
  @@index([status])
  @@index([trackingNumber])
}

model JournalVolume {
  id           String         @id @default(uuid())
  journalId    String
  volumeNumber Int
  year         Int
  isActive     Boolean        @default(true)
  issues       JournalIssue[]
  journal      Journal        @relation(fields: [journalId], references: [id])
}

model JournalIssue {
  id                  String        @id @default(uuid())
  volumeId            String
  issueNumber         Int
  month               String?
  title               String?
  status              IssueStatus   @default(PLANNED)
  publishedAt         DateTime?
  expectedManuscripts Int           @default(0)
  isComplete          Boolean       @default(false)
  validationStatus    String?
  articles            Article[]
  volume              JournalVolume @relation(fields: [volumeId], references: [id])
}

model Article {
  id               String          @id @default(uuid())
  title            String
  abstract         String?
  keywords         String?
  journalId        String
  issueId          String?
  submissionDate   DateTime        @default(now())
  acceptanceDate   DateTime?
  publicationDate  DateTime?
  status           ArticleStatus   @default(SUBMITTED)
  fileUrl          String?
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt
  apcAmountINR     Float?          @default(0)
  apcAmountUSD     Float?          @default(0)
  apcInvoiceId     String?
  apcPaymentStatus String          @default("UNPAID")
  apcType          APCType?
  issue            JournalIssue?   @relation(fields: [issueId], references: [id])
  journal          Journal         @relation(fields: [journalId], references: [id])
  authors          ArticleAuthor[]
  reviews          Review[]
}

model Review {
  id               String    @id @default(uuid())
  articleId        String
  reviewerId       String
  rating           Int?
  commentsToEditor String?
  commentsToAuthor String?
  recommendation   String?
  status           String    @default("PENDING")
  dueDate          DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  article          Article   @relation(fields: [articleId], references: [id])
  reviewer         User      @relation(fields: [reviewerId], references: [id])

  @@index([articleId])
  @@index([reviewerId])
}

model ArticleAuthor {
  id              String  @id @default(uuid())
  articleId       String
  userId          String?
  name            String
  email           String
  affiliation     String?
  isCorresponding Boolean @default(false)
  displayOrder    Int     @default(0)
  article         Article @relation(fields: [articleId], references: [id])
}

model Conference {
  id            String                   @id @default(uuid())
  title         String
  description   String
  startDate     DateTime
  endDate       DateTime
  venue         String?
  organizer     String?
  website       String?
  isActive      Boolean                  @default(true)
  createdAt     DateTime                 @default(now())
  updatedAt     DateTime                 @updatedAt
  companyId     String?
  company       Company?                 @relation(fields: [companyId], references: [id])
  papers        ConferencePaper[]
  registrations ConferenceRegistration[]
  ticketTypes   ConferenceTicketType[]
}

model ConferenceTicketType {
  id            String                   @id @default(uuid())
  conferenceId  String
  name          String
  price         Float
  currency      String                   @default("INR")
  limit         Int?
  soldCount     Int                      @default(0)
  registrations ConferenceRegistration[]
  conference    Conference               @relation(fields: [conferenceId], references: [id])
}

model ConferenceRegistration {
  id           String               @id @default(uuid())
  conferenceId String
  userId       String?
  name         String
  email        String
  organization String?
  ticketTypeId String
  amountPaid   Float
  status       String               @default("REGISTERED")
  paymentId    String?
  createdAt    DateTime             @default(now())
  conference   Conference           @relation(fields: [conferenceId], references: [id])
  ticketType   ConferenceTicketType @relation(fields: [ticketTypeId], references: [id])
}

model ConferencePaper {
  id            String     @id @default(uuid())
  conferenceId  String
  title         String
  abstract      String
  authors       String
  status        String     @default("SUBMITTED")
  presenterName String?
  presentedAt   DateTime?
  fileUrl       String?
  createdAt     DateTime   @default(now())
  conference    Conference @relation(fields: [conferenceId], references: [id])
}

model Course {
  id              String             @id @default(uuid())
  title           String
  description     String
  thumbnailUrl    String?
  price           Float              @default(0)
  currency        String             @default("INR")
  instructorId    String?
  isPublished     Boolean            @default(false)
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
  companyId       String?
  
  // Enhanced fields
  category        String?
  level           String?            @default("BEGINNER") // BEGINNER, INTERMEDIATE, ADVANCED
  language        String?            @default("English")
  prerequisites   String?            // Comma-separated course IDs
  estimatedHours  Int?
  
  company         Company?           @relation(fields: [companyId], references: [id])
  enrollments     CourseEnrollment[]
  modules         CourseModule[]
  discussions     CourseDiscussion[]
  announcements   CourseAnnouncement[]
}

model CourseModule {
  id          String         @id @default(uuid())
  courseId    String
  title       String
  description String?
  order       Int
  createdAt   DateTime       @default(now())
  lessons     CourseLesson[]
  course      Course         @relation(fields: [courseId], references: [id], onDelete: Cascade)
}

model CourseLesson {
  id          String               @id @default(uuid())
  moduleId    String
  title       String
  description String?
  order       Int
  type        String               @default("VIDEO") // VIDEO, TEXT, QUIZ, DOCUMENT, ASSIGNMENT
  contentUrl  String?
  textContent String?
  duration    Int?                 // in minutes
  isFree      Boolean              @default(false) // Preview lesson
  createdAt   DateTime             @default(now())
  
  module      CourseModule         @relation(fields: [moduleId], references: [id], onDelete: Cascade)
  progress    UserLessonProgress[]
  quizzes     Quiz[]
  notes       CourseNote[]
}

model CourseEnrollment {
  id              String        @id @default(uuid())
  courseId        String
  userId          String
  enrolledAt      DateTime      @default(now())
  completedAt     DateTime?
  progress        Float         @default(0)
  lastAccessedAt  DateTime?
  certificateUrl  String?
  status          String        @default("ACTIVE") // ACTIVE, COMPLETED, DROPPED
  
  course          Course        @relation(fields: [courseId], references: [id])
  user            User          @relation(fields: [userId], references: [id])
  certificate     Certificate?
  
  @@unique([userId, courseId])
}

model UserLessonProgress {
  id           String       @id @default(uuid())
  lessonId     String
  userId       String
  isCompleted  Boolean      @default(false)
  lastPosition Int?         // For video progress in seconds
  timeSpent    Int          @default(0) // in seconds
  updatedAt    DateTime     @updatedAt
  completedAt  DateTime?
  
  lesson       CourseLesson @relation(fields: [lessonId], references: [id])
  user         User         @relation(fields: [userId], references: [id])

  @@unique([userId, lessonId])
}

model Quiz {
  id           String               @id @default(uuid())
  lessonId     String
  title        String
  description  String?
  passingScore Int                  @default(70) // percentage
  timeLimit    Int?                 // in minutes
  maxAttempts  Int                  @default(3)
  shuffleQuestions Boolean          @default(false)
  showAnswers  Boolean              @default(true)
  createdAt    DateTime             @default(now())
  
  lesson       CourseLesson         @relation(fields: [lessonId], references: [id], onDelete: Cascade)
  questions    CourseQuizQuestion[]
  attempts     QuizAttempt[]
}

model CourseQuizQuestion {
  id            String   @id @default(uuid())
  quizId        String
  question      String
  type          String   @default("MULTIPLE_CHOICE") // MULTIPLE_CHOICE, TRUE_FALSE, SHORT_ANSWER
  options       Json?    // Array of options for multiple choice
  correctAnswer String
  explanation   String?
  points        Int      @default(1)
  order         Int
  
  quiz          Quiz     @relation(fields: [quizId], references: [id], onDelete: Cascade)
}

model QuizAttempt {
  id          String   @id @default(uuid())
  quizId      String
  userId      String
  score       Float
  passed      Boolean
  answers     Json     // User's answers
  timeSpent   Int?     // in seconds
  attemptedAt DateTime @default(now())
  
  quiz        Quiz     @relation(fields: [quizId], references: [id])
  user        User     @relation(fields: [userId], references: [id])
}

model CourseNote {
  id        String       @id @default(uuid())
  lessonId  String
  userId    String
  content   String
  timestamp Int?         // Video timestamp in seconds
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
  
  lesson    CourseLesson @relation(fields: [lessonId], references: [id], onDelete: Cascade)
  user      User         @relation(fields: [userId], references: [id])
}

model CourseDiscussion {
  id        String             @id @default(uuid())
  courseId  String
  userId    String
  title     String
  content   String
  isPinned  Boolean            @default(false)
  createdAt DateTime           @default(now())
  updatedAt DateTime           @updatedAt
  
  course    Course             @relation(fields: [courseId], references: [id], onDelete: Cascade)
  user      User               @relation(fields: [userId], references: [id])
  replies   DiscussionReply[]
}

model DiscussionReply {
  id           String           @id @default(uuid())
  discussionId String
  userId       String
  content      String
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt
  
  discussion   CourseDiscussion @relation(fields: [discussionId], references: [id], onDelete: Cascade)
  user         User             @relation(fields: [userId], references: [id])
}

model CourseAnnouncement {
  id        String   @id @default(uuid())
  courseId  String
  title     String
  content   String
  createdAt DateTime @default(now())
  
  course    Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
}

model Certificate {
  id               String           @id @default(uuid())
  enrollmentId     String           @unique
  userId           String
  courseId         String
  issuedAt         DateTime         @default(now())
  certificateUrl   String?
  verificationCode String           @unique
  
  enrollment       CourseEnrollment @relation(fields: [enrollmentId], references: [id])
  user             User             @relation(fields: [userId], references: [id])
}

model ITAsset {
  id             String            @id @default(uuid())
  companyId      String
  name           String
  type           String
  serialNumber   String?
  purchaseDate   DateTime?
  warrantyExpiry DateTime?
  status         String            @default("AVAILABLE")
  assignedToId   String?
  details        String?
  value          Float?
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  assignedTo     User?             @relation(fields: [assignedToId], references: [id])
  company        Company           @relation(fields: [companyId], references: [id])
  tickets        ITSupportTicket[]

  @@index([companyId])
  @@index([assignedToId])
}

model ITSupportTicket {
  id           String   @id @default(uuid())
  companyId    String
  requesterId  String
  assignedToId String?
  assetId      String?
  title        String
  description  String
  priority     String   @default("MEDIUM")
  status       String   @default("OPEN")
  category     String?
  resolution   String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  asset        ITAsset? @relation(fields: [assetId], references: [id])
  assignedTo   User?    @relation("ITResolver", fields: [assignedToId], references: [id])
  company      Company  @relation(fields: [companyId], references: [id])
  requester    User     @relation("ITRequestor", fields: [requesterId], references: [id])

  @@index([companyId])
  @@index([requesterId])
  @@index([status])
}

model FinancialRecord {
  id              String        @id @default(uuid())
  companyId       String?
  type            FinancialType @default(EXPENSE)
  category        String
  amount          Float
  currency        String        @default("INR")
  date            DateTime      @default(now())
  description     String?
  status          String        @default("COMPLETED")
  paymentMethod   String?
  referenceId     String?
  createdByUserId String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  company         Company?      @relation(fields: [companyId], references: [id])
  createdByUser   User?         @relation("FinanceCreator", fields: [createdByUserId], references: [id])

  @@index([companyId])
  @@index([type])
  @@index([category])
  @@index([date])
}

model LeaveLedger {
  id             String          @id @default(uuid())
  employeeId     String
  month          Int
  year           Int
  openingBalance Float           @default(0)
  takenLeaves    Float           @default(0)
  closingBalance Float           @default(0)
  remarks        String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  companyId      String?
  company        Company?        @relation(fields: [companyId], references: [id])
  employee       EmployeeProfile @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@unique([employeeId, month, year])
  @@index([companyId])
}

model EmployeeGoal {
  id           String          @id @default(uuid())
  employeeId   String
  title        String
  description  String?
  targetValue  Float
  currentValue Float           @default(0)
  unit         String
  type         GoalType        @default(MONTHLY)
  startDate    DateTime
  endDate      DateTime
  status       String          @default("IN_PROGRESS")
  companyId    String
  kpiId        String?
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt
  company      Company         @relation(fields: [companyId], references: [id])
  employee     EmployeeProfile @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  kpi          EmployeeKPI?    @relation(fields: [kpiId], references: [id])

  @@index([employeeId])
  @@index([companyId])
}

model IncentiveSchema {
  id          String     @id @default(uuid())
  companyId   String
  name        String
  description String?
  type        RewardType @default(PERCENTAGE)
  value       Float
  criteria    String?
  isActive    Boolean    @default(true)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  company     Company    @relation(fields: [companyId], references: [id])
}

model BonusSchema {
  id          String   @id @default(uuid())
  companyId   String
  name        String
  description String?
  amount      Float
  frequency   String   @default("YEARLY")
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  company     Company  @relation(fields: [companyId], references: [id])
}

model EmployeeIncentive {
  id                String          @id @default(uuid())
  employeeProfileId String
  amount            Float
  reason            String
  date              DateTime        @default(now())
  status            String          @default("PENDING")
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  employeeProfile   EmployeeProfile @relation(fields: [employeeProfileId], references: [id], onDelete: Cascade)
}

model CompanyPotential {
  id                  String   @id @default(uuid())
  companyId           String   @unique
  monthlyPotential    Float?
  quarterlyPotential  Float?
  halfYearlyPotential Float?
  yearlyPotential     Float?
  twoYearPotential    Float?
  threeYearPotential  Float?
  fiveYearPotential   Float?
  growthFactors       Json?
  marketData          Json?
  lastCalculated      DateTime @default(now())
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  company             Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
}

enum UserRole {
  SUPER_ADMIN
  ADMIN
  MANAGER
  TEAM_LEADER
  SALES_EXECUTIVE
  FINANCE_ADMIN
  CUSTOMER
  AGENCY
  EDITOR
}

enum CustomerType {
  INDIVIDUAL
  INSTITUTION
  AGENCY
}

enum InstitutionType {
  UNIVERSITY
  COLLEGE
  SCHOOL
  RESEARCH_INSTITUTE
  CORPORATE
  LIBRARY
  GOVERNMENT
  HOSPITAL
  NGO
  OTHER
}

enum CustomerDesignation {
  STUDENT
  TEACHER
  FACULTY
  HOD
  PRINCIPAL
  DEAN
  RESEARCHER
  LIBRARIAN
  ACCOUNTANT
  DIRECTOR
  REGISTRAR
  VICE_CHANCELLOR
  CHANCELLOR
  STAFF
  OTHER
}

enum SalesChannel {
  DIRECT
  AGENCY
}

enum SubscriptionStatus {
  REQUESTED
  ACTIVE
  PENDING_PAYMENT
  EXPIRED
  CANCELLED
  SUSPENDED
}

enum InvoiceStatus {
  PAID
  UNPAID
  PARTIALLY_PAID
  OVERDUE
  CANCELLED
  VOID
}

enum CommunicationType {
  EMAIL
  CALL
  COMMENT
  INQUIRY
  INVOICE_SENT
  CATALOGUE_SENT
  MEETING
}

enum Priority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum TaskStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum TicketStatus {
  OPEN
  IN_PROGRESS
  RESOLVED
  CLOSED
}

enum DispatchStatus {
  PENDING
  PROCESSING
  READY_TO_SHIP
  SHIPPED
  IN_TRANSIT
  DELIVERED
  RETURNED
  LOST
}

enum IssueStatus {
  PLANNED
  IN_PROGRESS
  PUBLISHED
  ARCHIVED
}

enum APCType {
  OPEN_ACCESS
  RAPID
  WOS
  OTHER
}

enum ArticleStatus {
  SUBMITTED
  UNDER_REVIEW
  REVISION_REQUESTED
  ACCEPTED
  REJECTED
  PUBLISHED
}

enum FinancialType {
  REVENUE
  EXPENSE
}

enum EmployeeType {
  FULL_TIME
  PART_TIME
  CONTRACT
  GIG_WORKIE
  FREELANCE
  INTERN
}

enum GoalType {
  MONTHLY
  QUARTERLY
  HALF_YEARLY
  YEARLY
}

enum RewardType {
  PERCENTAGE
  FIXED_AMOUNT
}
